<!DOCTYPE html>
<html lang="es">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4610DNY94F"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-4610DNY94F');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Herramienta de Negocio - Contador, Precios y Fotos</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* --- BANNER PUBLICITARIO --- */
        .promo-banner {
            background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            color: white;
            text-align: center;
            animation: slideDown 0.6s ease-out;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .promo-banner h2 {
            font-size: 1.8em;
            margin-bottom: 10px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .promo-banner p {
            font-size: 1.05em;
            margin-bottom: 15px;
            line-height: 1.6;
            font-weight: 500;
        }

        .whatsapp-btn {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: white;
            color: #25D366;
            padding: 15px 30px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 700;
            font-size: 1.1em;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .whatsapp-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }

        .whatsapp-btn:active {
            transform: scale(0.98);
        }

        h1.main-title {
            text-align: center;
            color: white;
            margin-bottom: 20px;
            font-size: 2.2em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        /* Sistema de PestaÃ±as */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .tab-button {
            padding: 15px 25px;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            font-size: 1.05em;
            cursor: pointer;
            border-radius: 12px;
            transition: all 0.3s;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .tab-button:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        .tab-button.active {
            background: white;
            color: #667eea;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            margin-bottom: 20px;
        }

        .section-title {
            color: #667eea;
            font-size: 1.6em;
            margin-bottom: 20px;
            border-bottom: 4px solid #667eea;
            padding-bottom: 10px;
            font-weight: 700;
        }

        .money-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .money-item {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 15px;
            border-radius: 12px;
            border-left: 5px solid #667eea;
            transition: all 0.3s;
        }

        .money-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .money-item label {
            display: block;
            font-weight: 700;
            color: #333;
            margin-bottom: 8px;
            font-size: 0.95em;
        }

        .money-item input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .money-item input:focus {
            outline: none;
            border-color: #667eea;
        }

        .total-display {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin-top: 20px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .total-display h2 {
            font-size: 1.3em;
            margin-bottom: 10px;
        }

        .total-display .amount {
            font-size: 3em;
            font-weight: 700;
        }

        .reset-btn {
            background: #6c757d;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 15px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .reset-btn:hover {
            background: #5a6268;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            font-weight: 700;
            margin-bottom: 8px;
            color: #333;
        }

        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            font-family: inherit;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .results {
            display: none;
            margin-top: 20px;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .results.show {
            display: grid;
        }

        .result-item {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 15px;
            border-radius: 12px;
            border-left: 5px solid #667eea;
        }

        .result-item h3 { color: #667eea; font-size: 1em; margin-bottom: 8px; font-weight: 700; }
        .result-item .value { font-size: 1.8em; font-weight: 700; color: #333; }

        .result-item.profit { border-left-color: #28a745; }
        .result-item.profit h3 { color: #28a745; }

        /* --- FOTOS --- */
        .upload-btn {
            display: block;
            width: 100%;
            padding: 40px 20px;
            border: 3px dashed #667eea;
            border-radius: 15px;
            background: linear-gradient(135deg, #f8f9ff 0%, #e9ecef 100%);
            cursor: pointer;
            text-align: center;
            margin-bottom: 20px;
            position: relative;
            transition: all 0.3s;
        }

        .upload-btn:hover {
            background: linear-gradient(135deg, #e9ecef 0%, #f8f9ff 100%);
            border-color: #764ba2;
        }

        .upload-icon { font-size: 50px; display: block; margin-bottom: 10px; }
        .upload-text { font-size: 1.2em; font-weight: 700; color: #667eea; }
        .upload-hint { font-size: 0.95em; color: #666; margin-top: 5px; }
        #fileInput { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; }

        .page-config { background: linear-gradient(135deg, #f0f4ff 0%, #e9ecef 100%); padding: 20px; border-radius: 12px; margin-bottom: 20px; }
        .page-config h3 { margin-bottom: 15px; color: #333; font-weight: 700; }
        .page-size-options, .layout-options { display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; }
        .page-size-btn, .layout-btn { flex: 1; padding: 12px; border: 2px solid #667eea; background: white; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s; }
        .page-size-btn:hover, .layout-btn:hover { transform: translateY(-2px); }
        .page-size-btn.active, .layout-btn.active { background: #667eea; color: white; }

        .images-list { margin-bottom: 20px; max-height: 60vh; overflow-y: auto; }
        .image-item { background: white; border: 2px solid #e0e0e0; border-radius: 12px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .image-header { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; }
        .image-thumbnail { width: 70px; height: 70px; object-fit: cover; border-radius: 8px; border: 2px solid #667eea; }
        .image-controls { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        .control-group.full-width { grid-column: 1 / -1; }
        .quantity-row { display: flex; align-items: center; gap: 8px; }
        .qty-btn { width: 44px; height: 44px; background: #667eea; color: white; border: none; border-radius: 8px; font-size: 20px; cursor: pointer; font-weight: bold; transition: all 0.3s; }
        .qty-btn:hover { background: #764ba2; }
        .qty-input { flex: 1; text-align: center; font-weight: bold; border: 2px solid #ddd; border-radius: 5px; padding: 8px; }

        .bg-remover-section { background: #f8f9ff; border: 2px solid #e0e7ff; border-radius: 8px; padding: 12px; margin-bottom: 10px; grid-column: 1 / -1; }
        .btn-remove-bg { width: 100%; padding: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s; }
        .btn-remove-bg:hover { transform: translateY(-2px); }

        .action-buttons { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .btn-duplicate { background: #4ade80; color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s; }
        .btn-duplicate:hover { background: #22c55e; }
        .btn-remove { background: #ff4757; color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s; }
        .btn-remove:hover { background: #ff3838; }

        .preview-section { margin: 20px 0; text-align: center; display: none; }
        .sheet-preview { border: 2px solid #333; margin: 0 auto; position: relative; background: white; box-shadow: 0 4px 12px rgba(0,0,0,0.1); display: inline-block; }
        .preview-image { position: absolute; overflow: hidden; display: flex; align-items: center; justify-content: center; box-sizing: border-box; }
        .preview-image img { max-width: 100%; max-height: 100%; object-fit: contain; }
        .preview-number { position: absolute; top: 2px; left: 2px; background: #667eea; color: white; width: 20px; height: 20px; border-radius: 50%; font-size: 11px; display: flex; align-items: center; justify-content: center; z-index: 5; font-weight: bold; }

        .main-buttons { display: flex; flex-direction: column; gap: 12px; margin-top: 20px; }
        .main-btn { padding: 16px; border: none; border-radius: 12px; font-size: 1.05em; font-weight: 700; cursor: pointer; color: white; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .main-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0,0,0,0.2); }
        .btn-organize { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .btn-print { background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%); }
        .btn-download { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); }
        .btn-clear { background: linear-gradient(135deg, #ff4757 0%, #ff3838 100%); }

        .loading { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1000; align-items: center; justify-content: center; }
        .loading-content { background: white; padding: 30px; border-radius: 15px; text-align: center; }
        .spinner { width: 50px; height: 50px; border: 5px solid #f3f3f3; border-top: 5px solid #667eea; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 15px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        @media (max-width: 768px) {
            .money-grid { grid-template-columns: 1fr 1fr; }
            .tab-button { flex: 1; font-size: 0.95em; padding: 12px; }
            h1.main-title { font-size: 1.6em; }
            .promo-banner h2 { font-size: 1.5em; }
            .promo-banner p { font-size: 0.95em; }
            .total-display .amount { font-size: 2.2em; }
        }
    </style>
</head>
<body>

    <div class="container">
        <!-- BANNER PUBLICITARIO DINÃMICO -->
        <div class="promo-banner" id="promoBanner">
            <!-- Se llena dinÃ¡micamente con JavaScript -->
        </div>

        <h1 class="main-title">
            <span>ğŸ’¼</span>
            Herramienta de Negocio
        </h1>

        <!-- NAVEGACIÃ“N -->
        <div class="tabs">
            <button class="tab-button active" onclick="switchTab('contador')">ğŸ’° Contador de Dinero</button>
            <button class="tab-button" onclick="switchTab('calculadora')">ğŸ“Š Calculadora de Precios</button>
            <button class="tab-button" onclick="switchTab('fotos')">ğŸ–¼ï¸ Organizador de Fotos</button>
        </div>

        <!-- TAB 1: CONTADOR DE DINERO -->
        <div id="contador" class="tab-content active">
            <div class="card">
                <h2 class="section-title">ğŸ’µ Billetes</h2>
                <div class="money-grid">
                    <div class="money-item"><label>$1000</label><input type="number" id="b1000" value="0" min="0" oninput="calcularTotal()"></div>
                    <div class="money-item"><label>$500</label><input type="number" id="b500" value="0" min="0" oninput="calcularTotal()"></div>
                    <div class="money-item"><label>$200</label><input type="number" id="b200" value="0" min="0" oninput="calcularTotal()"></div>
                    <div class="money-item"><label>$100</label><input type="number" id="b100" value="0" min="0" oninput="calcularTotal()"></div>
                    <div class="money-item"><label>$50</label><input type="number" id="b50" value="0" min="0" oninput="calcularTotal()"></div>
                    <div class="money-item"><label>$20</label><input type="number" id="b20" value="0" min="0" oninput="calcularTotal()"></div>
                </div>
                <h2 class="section-title">ğŸª™ Monedas</h2>
                <div class="money-grid">
                    <div class="money-item"><label>$20</label><input type="number" id="m20" value="0" min="0" oninput="calcularTotal()"></div>
                    <div class="money-item"><label>$10</label><input type="number" id="m10" value="0" min="0" oninput="calcularTotal()"></div>
                    <div class="money-item"><label>$5</label><input type="number" id="m5" value="0" min="0" oninput="calcularTotal()"></div>
                    <div class="money-item"><label>$2</label><input type="number" id="m2" value="0" min="0" oninput="calcularTotal()"></div>
                    <div class="money-item"><label>$1</label><input type="number" id="m1" value="0" min="0" oninput="calcularTotal()"></div>
                    <div class="money-item"><label>$0.50</label><input type="number" id="m050" value="0" min="0" oninput="calcularTotal()"></div>
                </div>
                <div class="total-display">
                    <h2>Total en Caja</h2>
                    <div class="amount" id="totalDisplay">$0.00</div>
                    <button class="reset-btn" onclick="resetearContador()">ğŸ”„ Limpiar Contador</button>
                </div>
            </div>
        </div>

        <!-- TAB 2: CALCULADORA DE PRECIOS -->
        <div id="calculadora" class="tab-content">
            <div class="card">
                <h2 class="section-title">ğŸ“Š Calculadora de Ganancias</h2>
                <div class="form-group">
                    <label>Nombre del Producto:</label>
                    <input type="text" id="nombreProducto" placeholder="Ej: Camiseta Blanca">
                </div>
                <div class="money-grid">
                    <div class="form-group"><label>Costo Total:</label><input type="number" id="costoTotal" oninput="calcularGanancias()"></div>
                    <div class="form-group"><label>Cantidad Piezas:</label><input type="number" id="cantidadPiezas" oninput="calcularGanancias()"></div>
                    <div class="form-group"><label>Precio Venta (u):</label><input type="number" id="precioVenta" oninput="calcularGanancias()"></div>
                </div>
                <div id="results" class="results">
                    <div class="result-item"><h3>Costo por Pieza</h3><div class="value" id="costoPieza">$0.00</div></div>
                    <div class="result-item" id="precioVentaItem"><h3>Precio Venta</h3><div class="value" id="precioVentaDisplay">$0.00</div></div>
                    <div class="result-item profit" id="gananciaItem"><h3>Ganancia por Pieza</h3><div class="value" id="gananciaPieza">$0.00</div></div>
                    <div class="result-item profit" id="porcentajeItem"><h3>Margen %</h3><div class="value" id="porcentajeGanancia">0%</div></div>
                    <div class="result-item profit" id="totalGananciaItem"><h3>Ganancia Total</h3><div class="value" id="gananciaTotal">$0.00</div></div>
                </div>
                <button class="reset-btn" onclick="resetearCalculadora()">ğŸ”„ Limpiar Calculadora</button>
            </div>
        </div>

        <!-- TAB 3: ORGANIZADOR DE FOTOS -->
        <div id="fotos" class="tab-content">
            <div class="card">
                <h2 class="section-title">ğŸ–¼ï¸ Organizador y Eliminador de Fondo</h2>
                <div class="upload-btn">
                    <span class="upload-icon">ğŸ“¸</span>
                    <span class="upload-text">ABRIR GALERÃA</span>
                    <span class="upload-hint">Toca para seleccionar fotos</span>
                    <input type="file" id="fileInput" accept="image/*" multiple>
                </div>

                <div class="page-config">
                    <h3>ğŸ“„ ConfiguraciÃ³n de Hoja</h3>
                    <div class="page-size-options">
                        <button class="page-size-btn active" onclick="setPageSize('a4', this)">A4</button>
                        <button class="page-size-btn" onclick="setPageSize('carta', this)">Carta</button>
                        <button class="page-size-btn" onclick="setPageSize('10x15', this)">10Ã—15</button>
                    </div>
                    <div class="layout-options">
                        <button class="layout-btn active" onclick="setOrientation('portrait', this)">Vertical</button>
                        <button class="layout-btn" onclick="setOrientation('landscape', this)">Horizontal</button>
                    </div>
                </div>

                <div id="imagesList" class="images-list"></div>

                <div class="preview-section" id="previewSection">
                    <h3 style="margin-bottom: 15px; font-size: 1.2em; color: #333;">Vista Previa</h3>
                    <div class="sheet-preview" id="sheetPreview"></div>
                    <p id="previewHint" style="margin-top:15px; color:#666; font-size:14px; font-weight: 600;"></p>
                </div>

                <div class="main-buttons">
                    <button class="main-btn btn-organize" id="organizeBtn" disabled onclick="organizeImages()">ğŸ¯ Organizar en Hoja</button>
                    <button class="main-btn btn-print" id="printBtn" disabled onclick="openPrintWindow()">ğŸ–¨ï¸ Imprimir</button>
                    <button class="main-btn btn-download" id="downloadBtn" disabled onclick="downloadSheet()">ğŸ’¾ Descargar Imagen</button>
                    <button class="main-btn btn-clear" onclick="clearAll()">ğŸ—‘ï¸ Limpiar Todo</button>
                </div>
            </div>
        </div>
    </div>

    <div class="loading" id="loading">
        <div class="loading-content">
            <div class="spinner"></div>
            <p style="font-weight: 600; color: #333;">Procesando...</p>
        </div>
    </div>

    <script>
        // â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        // â•‘              âš™ï¸ CONFIGURACIÃ“N DE PUBLICIDADES                  â•‘
        // â•‘                                                                â•‘
        // â•‘  ğŸ‘‡ SOLO CAMBIA: true/false, titulo, descripcion,            â•‘
        // â•‘     whatsapp y emoji. NO TOQUES NADA MÃS ğŸ‘‡                  â•‘
        // â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        const PUBLICIDADES_PLANTILLAS = {
            // PLANTILLA 1: Tu negocio de sistemas
            plantilla1: {
                activo: true,  // â† CAMBIA A: true (activar) o false (desactivar)
                titulo: "ğŸš€ Â¿Necesitas un sistema para tu negocio?",
                descripcion: "Sistemas personalizados â€¢ Puntos de venta a tus necesidades\nWeb para llevar tu inventario y mucho mÃ¡s",
                whatsapp: "5570520358",
                emoji: "ğŸš€",
                color: "#25D366"
            },

            // PLANTILLA 2: PapelerÃ­a
            plantilla2: {
                activo: false,  // â† CAMBIA A: true (activar) o false (desactivar)
                titulo: "ğŸ“š PapelerÃ­a XYZ - Tus Ãºtiles escolares",
                descripcion: "Cuadernos â€¢ BolÃ­grafos â€¢ Mochilas\nLos mejores precios en Ãºtiles escolares",
                whatsapp: "1234567890",
                emoji: "ğŸ“š",
                color: "#FF6B6B"
            },

            // PLANTILLA 3: Tienda de ropa
            plantilla3: {
                activo: false,  // â† CAMBIA A: true (activar) o false (desactivar)
                titulo: "ğŸ‘• Tienda de Ropa - Moda para ti",
                descripcion: "Camisetas â€¢ Pantalones â€¢ Accesorios\nLas mejores marcas al mejor precio",
                whatsapp: "9876543210",
                emoji: "ğŸ‘•",
                color: "#3B82F6"
            },

            // PLANTILLA 4: Abarrotes
            plantilla4: {
                activo: false,  // â† CAMBIA A: true (activar) o false (desactivar)
                titulo: "ğŸ›’ Abarrotes Don Juan",
                descripcion: "Productos frescos â€¢ Precios bajos\nTu tienda de confianza",
                whatsapp: "5555555555",
                emoji: "ğŸ›’",
                color: "#8B5CF6"
            },

            // PLANTILLA 5: Restaurante
            plantilla5: {
                activo: false,  // â† CAMBIA A: true (activar) o false (desactivar)
                titulo: "ğŸ• Restaurante La Buena Mesa",
                descripcion: "Comida deliciosa â€¢ Delivery disponible\nPedidos al WhatsApp",
                whatsapp: "1111111111",
                emoji: "ğŸ•",
                color: "#EC4899"
            },
        };

        // â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        // â•‘                   FIN DE LA CONFIGURACIÃ“N                      â•‘
        // â•‘              No edites nada despuÃ©s de esta lÃ­nea              â•‘
        // â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        let PUBLICIDADES = [];
        let currentAdIndex = 0;

        // Cargar solo las publicidades activas
        function cargarPublicidadesActivas() {
            PUBLICIDADES = [];
            for (let key in PUBLICIDADES_PLANTILLAS) {
                const plantilla = PUBLICIDADES_PLANTILLAS[key];
                if (plantilla.activo === true) {
                    PUBLICIDADES.push(plantilla);
                }
            }
        }

        function displayCurrentAd() {
            if (PUBLICIDADES.length === 0) {
                document.getElementById('promoBanner').innerHTML = '<p style="color: white; font-weight: 700;">âš ï¸ No hay publicidades activas. Activa al menos una en la configuraciÃ³n.</p>';
                return;
            }
            
            const ad = PUBLICIDADES[currentAdIndex];
            const waLink = `https://wa.me/${ad.whatsapp}?text=Hola%20necesito%20informaci%C3%B3n`;
            
            document.getElementById('promoBanner').innerHTML = `
                <h2>${ad.emoji} ${ad.titulo}</h2>
                <p>${ad.descripcion.replace(/\n/g, '<br>')}</p>
                <a href="${waLink}" class="whatsapp-btn" target="_blank">
                    <span>ğŸ“±</span>
                    WhatsApp: ${ad.whatsapp}
                </a>
            `;
            document.getElementById('promoBanner').style.background = `linear-gradient(135deg, ${ad.color} 0%, ${adjustColor(ad.color, -20)} 100%)`;
        }

        function adjustColor(color, percent) {
            const num = parseInt(color.replace("#",""), 16);
            const amt = Math.round(2.55 * percent);
            const R = (num >> 16) + amt;
            const G = (num >> 8 & 0x00FF) + amt;
            const B = (num & 0x0000FF) + amt;
            return "#" + (0x1000000 + (R<255?R<1?0:R:255)*0x10000 +
                (G<255?G<1?0:G:255)*0x100 + (B<255?B<1?0:B:255))
                .toString(16).slice(1);
        }

        // Cambiar publicidad cada 10 segundos
        setInterval(() => {
            if (PUBLICIDADES.length > 1) {
                currentAdIndex = (currentAdIndex + 1) % PUBLICIDADES.length;
                displayCurrentAd();
            }
        }, 10000);

        /* --- JAVASCRIPT NEGOCIO --- */
        function calcularTotal() {
            const billetes = { b1000: 1000, b500: 500, b200: 200, b100: 100, b50: 50, b20: 20 };
            const monedas = { m20: 20, m10: 10, m5: 5, m2: 2, m1: 1, m050: 0.5 };
            let total = 0;
            for (let id in billetes) total += (parseFloat(document.getElementById(id).value) || 0) * billetes[id];
            for (let id in monedas) total += (parseFloat(document.getElementById(id).value) || 0) * monedas[id];
            document.getElementById('totalDisplay').textContent = '$' + total.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        function resetearContador() {
            ['b1000', 'b500', 'b200', 'b100', 'b50', 'b20', 'm20', 'm10', 'm5', 'm2', 'm1', 'm050'].forEach(id => document.getElementById(id).value = 0);
            calcularTotal();
        }

        function calcularGanancias() {
            const costoTotal = parseFloat(document.getElementById('costoTotal').value) || 0;
            const cantidadPiezas = parseFloat(document.getElementById('cantidadPiezas').value) || 0;
            const precioVenta = parseFloat(document.getElementById('precioVenta').value) || 0;
            if (costoTotal > 0 && cantidadPiezas > 0) {
                const costoPorPieza = costoTotal / cantidadPiezas;
                document.getElementById('costoPieza').textContent = '$' + costoPorPieza.toFixed(2);
                document.getElementById('results').classList.add('show');
                if (precioVenta > 0) {
                    const gananciaPorPieza = precioVenta - costoPorPieza;
                    const porcentajeGanancia = (gananciaPorPieza / costoPorPieza) * 100;
                    document.getElementById('precioVentaDisplay').textContent = '$' + precioVenta.toFixed(2);
                    document.getElementById('gananciaPieza').textContent = '$' + gananciaPorPieza.toFixed(2);
                    document.getElementById('porcentajeGanancia').textContent = porcentajeGanancia.toFixed(2) + '%';
                    document.getElementById('gananciaTotal').textContent = '$' + (gananciaPorPieza * cantidadPiezas).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                    ['precioVentaItem', 'gananciaItem', 'porcentajeItem', 'totalGananciaItem'].forEach(id => document.getElementById(id).style.display = 'block');
                } else {
                    ['precioVentaItem', 'gananciaItem', 'porcentajeItem', 'totalGananciaItem'].forEach(id => document.getElementById(id).style.display = 'none');
                }
            } else document.getElementById('results').classList.remove('show');
        }

        function resetearCalculadora() {
            ['nombreProducto', 'costoTotal', 'cantidadPiezas', 'precioVenta'].forEach(id => document.getElementById(id).value = '');
            document.getElementById('results').classList.remove('show');
        }

        /* --- JAVASCRIPT FOTOS --- */
        let images = [];
        let pageConfig = { width: 21, height: 29.7, orientation: 'portrait' };
        let nextId = 0;

        document.getElementById('fileInput').addEventListener('change', function(e) {
            if (this.files.length > 0) {
                showLoading(true);
                processFiles(this.files);
            }
        });

        async function processFiles(fileList) {
            const files = Array.from(fileList);
            for (let file of files) {
                if (!file.type.startsWith('image/')) continue;
                await new Promise(resolve => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const img = new Image();
                        img.onload = () => {
                            const data = {
                                id: nextId++, src: e.target.result, originalSrc: e.target.result,
                                fileName: file.name, originalWidth: img.width, originalHeight: img.height,
                                aspectRatio: img.width / img.height, quantity: 1, targetWidth: 10, targetHeight: 10,
                                preset: 'custom', bgRemoved: false
                            };
                            images.push(data);
                            renderImageCard(data);
                            resolve();
                        };
                        img.src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                });
            }
            showLoading(false);
            updateUI();
        }

        function renderImageCard(img) {
            const card = document.createElement('div');
            card.className = 'image-item';
            card.id = `card-${img.id}`;
            card.innerHTML = `
                <div class="image-header">
                    <img src="${img.src}" class="image-thumbnail" id="thumb-${img.id}">
                    <div class="image-info" style="flex: 1;">
                        <div style="font-weight:bold; font-size:14px;">${img.fileName}</div>
                        <div style="font-size:12px; color:#666;">${img.originalWidth}x${img.originalHeight}px</div>
                        <div id="badge-${img.id}">${img.bgRemoved ? '<span style="color:green; font-size:11px; font-weight: 600;">âœ“ Fondo eliminado</span>' : ''}</div>
                    </div>
                </div>
                <div class="image-controls">
                    <div class="control-group full-width">
                        <label>Copias:</label>
                        <div class="quantity-row">
                            <button class="qty-btn" onclick="changeQty(${img.id}, -1)">âˆ’</button>
                            <input type="number" class="qty-input" id="qty-${img.id}" value="1" onchange="updateQty(${img.id}, this.value)">
                            <button class="qty-btn" onclick="changeQty(${img.id}, 1)">+</button>
                        </div>
                    </div>
                    <div class="bg-remover-section">
                        <div style="font-size:12px; margin-bottom:8px; font-weight: 600;">ğŸ¨ Eliminar Fondo:</div>
                        <div style="margin-bottom: 8px;">
                            <label style="font-size: 11px; color: #555;">Color fondo:</label>
                            <input type="color" id="bgColor-${img.id}" value="#ffffff" style="width: 50px; height: 35px; border: none; border-radius: 5px; cursor: pointer;">
                        </div>
                        <div style="margin-bottom: 8px;">
                            <label style="font-size: 11px; color: #555;">Tolerancia:</label>
                            <input type="range" id="tolerance-${img.id}" min="0" max="100" value="30" style="width: 100%;">
                        </div>
                        <button class="btn-remove-bg" onclick="removeBackground(${img.id})">âœ¨ Eliminar Fondo</button>
                    </div>
                    <div class="control-group full-width">
                        <label>TamaÃ±o:</label>
                        <select onchange="applyPreset(${img.id}, this.value)" style="padding: 10px; border: 2px solid #ddd; border-radius: 8px;">
                            <option value="custom">Personalizado</option>
                            <option value="half">1/2 Hoja</option>
                            <option value="quarter">1/4 Hoja</option>
                            <option value="3x4">3x4 cm</option>
                            <option value="10x15">10x15 cm</option>
                        </select>
                    </div>
                    <div class="control-group"><label>Ancho (cm):</label><input type="number" id="width-${img.id}" value="10" step="0.1" onchange="updateCustomSize(${img.id})"></div>
                    <div class="control-group"><label>Alto (cm):</label><input type="number" id="height-${img.id}" value="10" step="0.1" onchange="updateCustomSize(${img.id})"></div>
                </div>
                <div class="action-buttons">
                    <button class="btn-duplicate" onclick="duplicateImage(${img.id})">â• Duplicar</button>
                    <button class="btn-remove" onclick="removeImage(${img.id})">ğŸ—‘ï¸ Eliminar</button>
                </div>
            `;
            document.getElementById('imagesList').appendChild(card);
        }

        function removeBackground(id) {
            const img = images.find(i => i.id === id);
            if (!img) return;
            showLoading(true);
            const colorHex = document.getElementById(`bgColor-${id}`).value;
            const tolerance = parseInt(document.getElementById(`tolerance-${id}`).value);
            setTimeout(() => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                canvas.width = img.originalWidth; canvas.height = img.originalHeight;
                const tempImg = new Image();
                tempImg.onload = () => {
                    ctx.drawImage(tempImg, 0, 0);
                    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    const data = imageData.data;
                    const rT = parseInt(colorHex.slice(1,3), 16), gT = parseInt(colorHex.slice(3,5), 16), bT = parseInt(colorHex.slice(5,7), 16);
                    for (let i = 0; i < data.length; i += 4) {
                        const dist = Math.sqrt(Math.pow(data[i]-rT,2)+Math.pow(data[i+1]-gT,2)+Math.pow(data[i+2]-bT,2));
                        if (dist <= tolerance * 2.55) data[i+3] = 0;
                    }
                    ctx.putImageData(imageData, 0, 0);
                    img.src = canvas.toDataURL('image/png');
                    img.bgRemoved = true;
                    document.getElementById(`thumb-${id}`).src = img.src;
                    document.getElementById(`badge-${id}`).innerHTML = '<span style="color:green; font-size:11px; font-weight: 600;">âœ“ Fondo eliminado</span>';
                    showLoading(false);
                };
                tempImg.src = img.originalSrc;
            }, 100);
        }

        function updateUI() {
            document.getElementById('organizeBtn').disabled = images.length === 0;
        }

        function changeQty(id, delta) {
            const img = images.find(i => i.id === id);
            if (img) updateQty(id, Math.max(1, (img.quantity || 1) + delta));
        }

        function updateQty(id, val) {
            const img = images.find(i => i.id === id);
            if (img) {
                img.quantity = Math.max(1, parseInt(val) || 1);
                document.getElementById(`qty-${id}`).value = img.quantity;
            }
        }

        function applyPreset(id, preset) {
            const img = images.find(i => i.id === id);
            if (!img) return;
            let w, h;
            const pW = pageConfig.orientation === 'portrait' ? pageConfig.width : pageConfig.height;
            const pH = pageConfig.orientation === 'portrait' ? pageConfig.height : pageConfig.width;
            if (preset === 'half') { w = pW; h = pH/2; }
            else if (preset === 'quarter') { w = pW/2; h = pH/2; }
            else if (preset === '3x4') { w = 3; h = 4; }
            else if (preset === '10x15') { w = 10; h = 15; }
            else return;
            img.targetWidth = w; img.targetHeight = h;
            document.getElementById(`width-${id}`).value = w.toFixed(1);
            document.getElementById(`height-${id}`).value = h.toFixed(1);
        }

        function updateCustomSize(id) {
            const img = images.find(i => i.id === id);
            if (img) {
                img.targetWidth = parseFloat(document.getElementById(`width-${id}`).value) || 10;
                img.targetHeight = parseFloat(document.getElementById(`height-${id}`).value) || 10;
            }
        }

        function duplicateImage(id) {
            const orig = images.find(i => i.id === id);
            if (orig) {
                const copy = {...orig, id: nextId++, quantity: 1};
                images.push(copy);
                renderImageCard(copy);
                updateUI();
            }
        }

        function removeImage(id) {
            images = images.filter(i => i.id !== id);
            document.getElementById(`card-${id}`).remove();
            updateUI();
            if (images.length === 0) {
                document.getElementById('previewSection').style.display = 'none';
                ['printBtn', 'downloadBtn'].forEach(id => document.getElementById(id).disabled = true);
            }
        }

        function setPageSize(size, btn) {
            document.querySelectorAll('.page-size-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            if (size === 'a4') { pageConfig.width = 21; pageConfig.height = 29.7; }
            else if (size === 'carta') { pageConfig.width = 21.6; pageConfig.height = 27.9; }
            else { pageConfig.width = 10; pageConfig.height = 15; }
            updatePreviewSize();
        }

        function setOrientation(orient, btn) {
            document.querySelectorAll('.layout-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            pageConfig.orientation = orient;
            updatePreviewSize();
        }

        function updatePreviewSize() {
            const w = pageConfig.orientation === 'portrait' ? pageConfig.width : pageConfig.height;
            const h = pageConfig.orientation === 'portrait' ? pageConfig.height : pageConfig.width;
            const preview = document.getElementById('sheetPreview');
            preview.style.width = `${w}cm`; preview.style.height = `${h}cm`;
        }

        function organizeImages() {
            showLoading(true);
            setTimeout(() => {
                const preview = document.getElementById('sheetPreview');
                preview.innerHTML = '';
                const sW = pageConfig.orientation === 'portrait' ? pageConfig.width : pageConfig.height;
                const sH = pageConfig.orientation === 'portrait' ? pageConfig.height : pageConfig.width;
                let curX = 0.5, curY = 0.5, rowH = 0, count = 0;
                images.forEach(img => {
                    for (let i = 0; i < img.quantity; i++) {
                        if (curX + img.targetWidth > sW - 0.5) { curX = 0.5; curY += rowH + 0.3; rowH = 0; }
                        if (curY + img.targetHeight > sH - 0.5) break;
                        const div = document.createElement('div');
                        div.className = 'preview-image';
                        div.style.left = `${curX}cm`; div.style.top = `${curY}cm`;
                        div.style.width = `${img.targetWidth}cm`; div.style.height = `${img.targetHeight}cm`;
                        div.innerHTML = `<span class="preview-number">${count+1}</span><img src="${img.src}">`;
                        preview.appendChild(div);
                        curX += img.targetWidth + 0.3;
                        rowH = Math.max(rowH, img.targetHeight);
                        count++;
                    }
                });
                document.getElementById('previewSection').style.display = 'block';
                document.getElementById('previewHint').textContent = `âœ“ ${count} imÃ¡genes organizadas correctamente`;
                ['printBtn', 'downloadBtn'].forEach(id => document.getElementById(id).disabled = count === 0);
                showLoading(false);
            }, 100);
        }

        function openPrintWindow() {
            const preview = document.getElementById('sheetPreview');
            const w = parseFloat(preview.style.width);
            const h = parseFloat(preview.style.height);
            
            const printWindow = window.open('', '', `width=${w*37.8},height=${h*37.8}`);
            const printDoc = printWindow.document;
            
            printDoc.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>Imprimir Hoja</title>
                    <style>
                        * { margin: 0; padding: 0; box-sizing: border-box; }
                        body { margin: 0; padding: 0; background: white; }
                        @page { margin: 0; size: ${w}cm ${h}cm; }
                        .sheet { width: ${w}cm; height: ${h}cm; position: relative; background: white; }
                        .preview-image { position: absolute; overflow: hidden; display: flex; align-items: center; justify-content: center; }
                        .preview-image img { max-width: 100%; max-height: 100%; object-fit: contain; }
                    </style>
                </head>
                <body>
                    <div class="sheet" id="sheet"></div>
                </body>
                </html>
            `);
            
            const sheet = printDoc.getElementById('sheet');
            const previews = preview.querySelectorAll('.preview-image');
            
            previews.forEach(div => {
                const newDiv = printDoc.createElement('div');
                newDiv.className = 'preview-image';
                newDiv.style.left = div.style.left;
                newDiv.style.top = div.style.top;
                newDiv.style.width = div.style.width;
                newDiv.style.height = div.style.height;
                
                const img = printDoc.createElement('img');
                img.src = div.querySelector('img').src;
                newDiv.appendChild(img);
                sheet.appendChild(newDiv);
            });
            
            printDoc.close();
            setTimeout(() => {
                printWindow.print();
            }, 500);
        }

        function downloadSheet() {
            showLoading(true);
            setTimeout(() => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const scale = 300 / 2.54;
                const w = parseFloat(document.getElementById('sheetPreview').style.width);
                const h = parseFloat(document.getElementById('sheetPreview').style.height);
                canvas.width = w * scale; canvas.height = h * scale;
                ctx.fillStyle = 'white'; ctx.fillRect(0, 0, canvas.width, canvas.height);
                const previews = document.querySelectorAll('.preview-image');
                let loaded = 0;
                previews.forEach(div => {
                    const img = new Image();
                    img.onload = () => {
                        ctx.drawImage(img, parseFloat(div.style.left)*scale, parseFloat(div.style.top)*scale, parseFloat(div.style.width)*scale, parseFloat(div.style.height)*scale);
                        loaded++;
                        if (loaded === previews.length) {
                            const a = document.createElement('a');
                            a.href = canvas.toDataURL('image/png');
                            a.download = 'hoja_organizada.png';
                            a.click();
                            showLoading(false);
                        }
                    };
                    img.src = div.querySelector('img').src;
                });
            }, 100);
        }

        function clearAll() {
            if (confirm('Â¿EstÃ¡s seguro de que deseas limpiar todo?')) {
                images = []; nextId = 0;
                document.getElementById('imagesList').innerHTML = '';
                document.getElementById('sheetPreview').innerHTML = '';
                document.getElementById('previewSection').style.display = 'none';
                updateUI();
            }
        }

        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            event.currentTarget.classList.add('active');
        }

        function showLoading(show) { document.getElementById('loading').style.display = show ? 'flex' : 'none'; }

        // Inicializar
        updatePreviewSize();
        cargarPublicidadesActivas();
        displayCurrentAd();
    </script>
</body>
</html>
